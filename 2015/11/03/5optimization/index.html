<!doctype html>



  


<html class="theme-next pisces use-motion" lang="default">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="algorithm,performanceOptimization," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="关于2SumTwo sum是一个很简单的问题,给定一个乱序列和一个target,找到两个数的和等于target.只要先sort然后用首尾两个pointers 反向逼近直到找到所求就可以了.可以找到所有符合要求的tuple,这里简化为解决第一个遇到的符合条件的tuple,找到全部组合见下面3sum.">
<meta property="og:type" content="article">
<meta property="og:title" content="一次不懈的速率优化-3Sum">
<meta property="og:url" content="http://yoursite.com/2015/11/03/5optimization/index.html">
<meta property="og:site_name" content="Coding 极简派">
<meta property="og:description" content="关于2SumTwo sum是一个很简单的问题,给定一个乱序列和一个target,找到两个数的和等于target.只要先sort然后用首尾两个pointers 反向逼近直到找到所求就可以了.可以找到所有符合要求的tuple,这里简化为解决第一个遇到的符合条件的tuple,找到全部组合见下面3sum.">
<meta property="og:updated_time" content="2017-01-04T13:06:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="一次不懈的速率优化-3Sum">
<meta name="twitter:description" content="关于2SumTwo sum是一个很简单的问题,给定一个乱序列和一个target,找到两个数的和等于target.只要先sort然后用首尾两个pointers 反向逼近直到找到所求就可以了.可以找到所有符合要求的tuple,这里简化为解决第一个遇到的符合条件的tuple,找到全部组合见下面3sum.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2015/11/03/5optimization/"/>





  <title> 一次不懈的速率优化-3Sum | Coding 极简派 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?914d24e843e09e68db881b3c66dfada5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Coding 极简派</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/03/5optimization/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="xubing">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Coding 极简派">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Coding 极简派" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                一次不懈的速率优化-3Sum
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-11-03T10:28:19+08:00">
                2015-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="关于2Sum"><a href="#关于2Sum" class="headerlink" title="关于2Sum"></a>关于2Sum</h1><p>Two sum是一个很简单的问题,给定一个乱序列和一个target,找到两个数的和等于target.<br>只要先sort然后用首尾两个pointers 反向逼近直到找到所求就可以了.可以找到所有符合要求的tuple,这里简化为解决第一个遇到的符合条件的tuple,找到全部组合见下面3sum.</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line"></div><div class="line">这里是题目的要求:</div><div class="line">Given an array of integers, find two numbers such that they add up to a specific target number.</div><div class="line"></div><div class="line">The function twoSum should return indices of the two numbers such that they add up to the target, where index1 must be less than index2. Please note that your returned answers (both index1 and index2) are not zero-based.</div><div class="line"></div><div class="line">You may assume that each input would have exactly one solution.</div><div class="line">'''</div><div class="line">  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, nums, target)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :type target: int</div><div class="line">        :rtype: List[int]</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> len(nums)&lt;<span class="number">2</span>:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        backup = nums[:]    </div><div class="line">        list.sort(nums)</div><div class="line">        i = <span class="number">0</span></div><div class="line">        j = len(nums)<span class="number">-1</span></div><div class="line">        <span class="keyword">while</span> i&lt;j:</div><div class="line">            <span class="keyword">if</span> (nums[i]+nums[j])&lt;target:</div><div class="line">                i=i+<span class="number">1</span></div><div class="line">            <span class="keyword">elif</span> (nums[i]+nums[j])&gt;target: </div><div class="line">                j=j<span class="number">-1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">if</span> nums[i]==nums[j]:</div><div class="line">                    index1 = backup.index(nums[i])</div><div class="line">                    backup.remove(nums[i])</div><div class="line">                    <span class="keyword">return</span> [index1+<span class="number">1</span>,backup.index(nums[j])+<span class="number">2</span>]    </div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    index1 = backup.index(nums[i])+<span class="number">1</span></div><div class="line">                    index2 = backup.index(nums[j])+<span class="number">1</span></div><div class="line">                    <span class="keyword">return</span> [min(index1,index2),max(index1,index2)]</div></pre></td></tr></table></figure>
<h1 id="3sum-摘掉面具"><a href="#3sum-摘掉面具" class="headerlink" title="3sum-摘掉面具"></a>3sum-摘掉面具</h1><p>Three sum 与two sum类似,是数组中找出所有三个数的组合加和为target.<br>它穿了一层马甲,我们摘掉他的面具, 将3Sum转化为解决了的2Sum问题,只要从0 loop 到 length-2 (设为x),对剩余数组找target-x,就转化成了twoSum.  </p>
<p>不同的一点是要找到全部组合,同时要排重.</p>
<p>我的第一个解法是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :rtype: List[List[int]]</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> len(nums)&lt;<span class="number">3</span>:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        result = []    </div><div class="line">        list.sort(nums)    </div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(nums)<span class="number">-2</span>):</div><div class="line">            target = -nums[x]</div><div class="line">            rs = self.twoSum(nums[x+<span class="number">1</span>:],target)</div><div class="line">            <span class="keyword">if</span>(rs!=[]):</div><div class="line">                <span class="keyword">for</span> r <span class="keyword">in</span> rs:</div><div class="line">                    <span class="keyword">if</span> [nums[x]]+r <span class="keyword">not</span> <span class="keyword">in</span> result:</div><div class="line">                        result.append([nums[x]]+r)</div><div class="line">        <span class="keyword">return</span> result</div><div class="line">        </div><div class="line">            </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self,nums,target)</span>:</span></div><div class="line">        i = <span class="number">0</span></div><div class="line">        j = len(nums)<span class="number">-1</span></div><div class="line">        tmprs = []</div><div class="line">        flag = <span class="number">0</span></div><div class="line">        <span class="keyword">while</span>(i&lt;j):</div><div class="line">            <span class="keyword">if</span> nums[i]+nums[j]&lt;target:</div><div class="line">                i = i+<span class="number">1</span></div><div class="line">            <span class="keyword">elif</span> nums[i]+nums[j]&gt;target:</div><div class="line">                j = j<span class="number">-1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">if</span> [nums[i],nums[j]] <span class="keyword">not</span> <span class="keyword">in</span> tmprs: </div><div class="line">                    tmprs.append( [nums[i],nums[j]])</div><div class="line">                i=i+<span class="number">1</span></div><div class="line">                j=j<span class="number">-1</span></div><div class="line">                <span class="keyword">continue</span></div><div class="line">        <span class="keyword">return</span> tmprs</div></pre></td></tr></table></figure>
<p>trivial. 然而速率却很慢,在使用python的人群中只beats about 30%.<br>Could stand? No.<br>开始优化.</p>
<h1 id="while-True-optimize"><a href="#while-True-optimize" class="headerlink" title="while True: optimize()"></a>while True: optimize()</h1><h2 id="排重优化0x00"><a href="#排重优化0x00" class="headerlink" title="排重优化0x00"></a><strong>排重优化0x00</strong></h2><p>第一个想法是先从排除重复结果上来优化.<br>在这个解法之前我试用完全得到包含重复的结果来2 pass 排重 会造成time exceed.因为这个排重过程已经是O(n^2)<br>这里用了 not in the list 来排重,O(n)的time complexity.想到可以用查询时间为O(1)的set来排重,然而list是unhashable的.</p>
<p>我尝试了化成string然后hash</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">strset = set()     </div><div class="line"><span class="keyword">if</span> str(tmp) <span class="keyword">not</span> <span class="keyword">in</span> strset:</div><div class="line">	result.append(tmp)</div><div class="line">	strset.add(str(tmp))</div><div class="line">	</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :rtype: List[List[int]]</div><div class="line">        """</div><div class="line">        hashset = set()    </div><div class="line">        result = []    </div><div class="line">        list.sort(nums)    </div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(nums)<span class="number">-2</span>):</div><div class="line">            target = -nums[x]</div><div class="line">            rs = self.twoSum(nums[x+<span class="number">1</span>:],target)</div><div class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> rs:</div><div class="line">                <span class="keyword">if</span> str([nums[x]]+r) <span class="keyword">not</span> <span class="keyword">in</span> hashset:</div><div class="line">                    result.append([nums[x]]+r)</div><div class="line">                    hashset.add(str([nums[x]]+r))</div><div class="line">    </div><div class="line">        <span class="keyword">return</span> result</div><div class="line">        </div><div class="line">            </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self,nums,target)</span>:</span></div><div class="line">        i = <span class="number">0</span></div><div class="line">        j = len(nums)<span class="number">-1</span></div><div class="line">        tmprs = []</div><div class="line">        <span class="keyword">while</span>(i&lt;j):</div><div class="line">            <span class="keyword">if</span> nums[i]+nums[j]&lt;target:</div><div class="line">                i = i+<span class="number">1</span></div><div class="line">            <span class="keyword">elif</span> nums[i]+nums[j]&gt;target:</div><div class="line">                j = j<span class="number">-1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">if</span> [nums[i],nums[j]] <span class="keyword">not</span> <span class="keyword">in</span> tmprs: </div><div class="line">                    tmprs.append( [nums[i],nums[j]])</div><div class="line">                i=i+<span class="number">1</span></div><div class="line">                j=j<span class="number">-1</span></div><div class="line">                <span class="keyword">continue</span></div><div class="line">        <span class="keyword">return</span> tmprs</div></pre></td></tr></table></figure>
<p>然而并未卵,之后怀疑是转化为str太慢吗,tuple结果一样.<br>…<br>被没有显著的变化.</p>
<h2 id="排重优化0x01"><a href="#排重优化0x01" class="headerlink" title="排重优化0x01"></a><strong>排重优化0x01</strong></h2><p>要减小排重带来的overhead. 上面的思路一直是在得到搜索结果之后再排重,那么一个反向的想法是我应该在搜索之前就排重,想如果第一个数是一样的化,之后twoSum的结果也是相同的,那么这次twoSum 的搜索就是没有意义的,于是我记录之前第一个数prev,就继续找下一个起点  </p>
<p>改进如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :rtype: List[List[int]]</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> len(nums)&lt;<span class="number">3</span>:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        result = []    </div><div class="line">        list.sort(nums)</div><div class="line">        </div><div class="line">        prev = <span class="keyword">None</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(nums)<span class="number">-2</span>):</div><div class="line">            target = -nums[x]</div><div class="line">            <span class="keyword">if</span> target == prev:</div><div class="line">                <span class="keyword">continue</span> </div><div class="line">            prev = target</div><div class="line">            rs = self.twoSum(nums[x+<span class="number">1</span>:],target)</div><div class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> rs:</div><div class="line">                result.append([nums[x]]+r)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result</div><div class="line">        </div><div class="line">            </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self,nums,target)</span>:</span></div><div class="line">        i = <span class="number">0</span></div><div class="line">        j = len(nums)<span class="number">-1</span></div><div class="line">        tmprs = []</div><div class="line">        <span class="keyword">while</span>(i&lt;j):</div><div class="line">            <span class="keyword">if</span> nums[i]+nums[j]&lt;target:</div><div class="line">                i = i+<span class="number">1</span></div><div class="line">            <span class="keyword">elif</span> nums[i]+nums[j]&gt;target:</div><div class="line">                j = j<span class="number">-1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">if</span> [nums[i],nums[j]] <span class="keyword">not</span> <span class="keyword">in</span> tmprs: </div><div class="line">                    tmprs.append( [nums[i],nums[j]])</div><div class="line">                i=i+<span class="number">1</span></div><div class="line">                j=j<span class="number">-1</span></div><div class="line">                <span class="keyword">continue</span></div><div class="line">        <span class="keyword">return</span> tmprs</div></pre></td></tr></table></figure>
<p>这样就可以减调每次的线性排查   if [nums[x]]+r not in result:</p>
<p>performance有了进步,达到了50%左右.  </p>
<h2 id="排重优化0x02"><a href="#排重优化0x02" class="headerlink" title="排重优化0x02"></a><strong>排重优化0x02</strong></h2><p>在外围即第一个数事先排重之后,在twoSum搜索中也应该事先排重,<br>之前的loop是i++,j– 来前进一步,然而很有可能依然有重复值.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :rtype: List[List[int]]</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> len(nums)&lt;<span class="number">3</span>:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        result = []    </div><div class="line">        list.sort(nums)</div><div class="line">        </div><div class="line">        prev = <span class="keyword">None</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(nums)<span class="number">-2</span>):</div><div class="line">            target = -nums[x]</div><div class="line">            <span class="keyword">if</span> target == prev:</div><div class="line">                <span class="keyword">continue</span> </div><div class="line">            prev = target</div><div class="line">            rs = self.twoSum(nums[x+<span class="number">1</span>:],target)</div><div class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> rs:</div><div class="line">                result.append([nums[x]]+r)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result</div><div class="line">        </div><div class="line">            </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self,nums,target)</span>:</span></div><div class="line">        i = <span class="number">0</span></div><div class="line">        j = len(nums)<span class="number">-1</span></div><div class="line">        tmprs = []</div><div class="line">        <span class="keyword">while</span>(i&lt;j):</div><div class="line">            <span class="keyword">if</span> nums[i]+nums[j]&lt;target:</div><div class="line">                i = i+<span class="number">1</span></div><div class="line">            <span class="keyword">elif</span> nums[i]+nums[j]&gt;target:</div><div class="line">                j = j<span class="number">-1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                     </div><div class="line">                <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums[i]==nums[i+<span class="number">1</span>]:</div><div class="line">                    i =i+<span class="number">1</span></div><div class="line">                <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums[j]==nums[j<span class="number">-1</span>]:    </div><div class="line">                    j =j<span class="number">-1</span></div><div class="line">                    </div><div class="line">                tmprs.append( [nums[i],nums[j]])    </div><div class="line">                i=i+<span class="number">1</span></div><div class="line">                j=j<span class="number">-1</span></div><div class="line">                <span class="keyword">continue</span></div><div class="line">        <span class="keyword">return</span> tmprs</div></pre></td></tr></table></figure>
<p>nice, 速率达到了60%多.</p>
<p>接下来该优化哪里呢?<br>我开始到处放空枪,看有没有机会打下一只鸟.  </p>
<h2 id="0x03-去除method-call"><a href="#0x03-去除method-call" class="headerlink" title="0x03 去除method call"></a><strong>0x03 去除method call</strong></h2><p>我开始想在dynamic programming中反复recruisive call 造成的overhead. 于是我省去另建函数twoSum.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :rtype: List[List[int]]</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> len(nums)&lt;<span class="number">3</span>:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        result = []    </div><div class="line">        list.sort(nums)</div><div class="line">        </div><div class="line">        prev = <span class="keyword">None</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(nums)<span class="number">-2</span>):</div><div class="line">            target = -nums[x]</div><div class="line">            <span class="keyword">if</span> target == prev:</div><div class="line">                <span class="keyword">continue</span> </div><div class="line">            prev = target</div><div class="line">            nums1 = nums[x+<span class="number">1</span>:]</div><div class="line">            i = <span class="number">0</span></div><div class="line">            j = len(nums1)<span class="number">-1</span></div><div class="line">            tmprs = []</div><div class="line">            <span class="keyword">while</span>(i&lt;j):</div><div class="line">                <span class="keyword">if</span> nums1[i]+nums1[j]&lt;target:</div><div class="line">                    i = i+<span class="number">1</span></div><div class="line">                <span class="keyword">elif</span> nums1[i]+nums1[j]&gt;target:</div><div class="line">                    j = j<span class="number">-1</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums1[i]==nums1[i+<span class="number">1</span>]:</div><div class="line">                        i =i+<span class="number">1</span></div><div class="line">                    <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums1[j]==nums1[j<span class="number">-1</span>]:    </div><div class="line">                        j =j<span class="number">-1</span></div><div class="line">                    tmprs.append( [nums1[i],nums1[j]])    </div><div class="line">                    i=i+<span class="number">1</span></div><div class="line">                    j=j<span class="number">-1</span></div><div class="line">                    <span class="keyword">continue</span></div><div class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> tmprs:</div><div class="line">                result.append([nums[x]]+r)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result</div></pre></td></tr></table></figure>
<p>一声空响.  </p>
<p>每次function被放在stack上,用后即delete, 和recuisive call 造成的overhead无法相提并论.  </p>
<h2 id="0x04-去除list-copy"><a href="#0x04-去除list-copy" class="headerlink" title="0x04 去除list copy"></a><strong>0x04 去除list copy</strong></h2><p>突然意识到我每次都copy了后段list来传入twoSum,造成了很大浪费,应该只传入原list,只要改变index就可以了,这样才不违背在最开始时候就进行sort的初衷.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :rtype: List[List[int]]</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> len(nums)&lt;<span class="number">3</span>:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        result = []    </div><div class="line">        list.sort(nums)</div><div class="line">        </div><div class="line">        prev = <span class="keyword">None</span></div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(nums)<span class="number">-2</span>):</div><div class="line">            target = -nums[x]</div><div class="line">            <span class="keyword">if</span> target == prev:</div><div class="line">                <span class="keyword">continue</span> </div><div class="line">            prev = target</div><div class="line">            i = x+<span class="number">1</span></div><div class="line">            j = len(nums)<span class="number">-1</span></div><div class="line">            tmprs = []</div><div class="line">            <span class="keyword">while</span>(i&lt;j):</div><div class="line">                <span class="keyword">if</span> nums[i]+nums[j]&lt;target:</div><div class="line">                    i = i+<span class="number">1</span></div><div class="line">                <span class="keyword">elif</span> nums[i]+nums[j]&gt;target:</div><div class="line">                    j = j<span class="number">-1</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums[i]==nums[i+<span class="number">1</span>]:</div><div class="line">                        i =i+<span class="number">1</span></div><div class="line">                    <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums[j]==nums[j<span class="number">-1</span>]:    </div><div class="line">                        j =j<span class="number">-1</span></div><div class="line">                    tmprs.append( [nums[i],nums[j]])    </div><div class="line">                    i=i+<span class="number">1</span></div><div class="line">                    j=j<span class="number">-1</span></div><div class="line">                    <span class="keyword">continue</span></div><div class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> tmprs:</div><div class="line">                result.append([nums[x]]+r)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result</div></pre></td></tr></table></figure>
<p>速率达到了80%-90%</p>
<h2 id="0x05-last-shot"><a href="#0x05-last-shot" class="headerlink" title="0x05 last shot"></a><strong>0x05</strong> last shot</h2><p>统一了外部的事先排重,这里的一个教训是对于有序数列来说,排重是很有优势的,应该利用order事先排除,loop until 一个不同的值出现.  </p>
<p>而我之前的做法其实是浪费已排序的这个已知信息资源.  </p>
<p>对于未消逝的变量,根本没有必要每次记录history.</p>
<p>改进如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :type nums: List[int]</div><div class="line">        :rtype: List[List[int]]</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> len(nums)&lt;<span class="number">3</span>:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        result = []    </div><div class="line">        list.sort(nums)</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(len(nums)<span class="number">-2</span>):</div><div class="line">            target = -nums[x]</div><div class="line">            <span class="keyword">if</span> x&gt;<span class="number">0</span> <span class="keyword">and</span> target == -nums[x<span class="number">-1</span>]:</div><div class="line">                <span class="keyword">continue</span> </div><div class="line">            i = x+<span class="number">1</span></div><div class="line">            j = len(nums)<span class="number">-1</span></div><div class="line">            <span class="keyword">while</span>(i&lt;j):</div><div class="line">                <span class="keyword">if</span> nums[i]+nums[j]&lt;target:</div><div class="line">                    i = i+<span class="number">1</span></div><div class="line">                <span class="keyword">elif</span> nums[i]+nums[j]&gt;target:</div><div class="line">                    j = j<span class="number">-1</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums[i]==nums[i+<span class="number">1</span>]:</div><div class="line">                        i =i+<span class="number">1</span></div><div class="line">                    <span class="keyword">while</span> i&lt;j <span class="keyword">and</span> nums[j]==nums[j<span class="number">-1</span>]:    </div><div class="line">                        j =j<span class="number">-1</span></div><div class="line">                    result.append([nums[x],nums[i],nums[j]])    </div><div class="line">                    i=i+<span class="number">1</span></div><div class="line">                    j=j<span class="number">-1</span></div><div class="line">                    <span class="keyword">continue</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> result</div></pre></td></tr></table></figure>
<p>bingo! 速率达到了 python人群的 <strong>90%</strong> 左右.</p>
<h2 id="0x06-Not-the-end"><a href="#0x06-Not-the-end" class="headerlink" title="0x06 Not the end"></a><strong>0x06 Not the end</strong></h2><p>这一定不是终结,还没有想到进一步的优化方式,先用一个法则来自我安慰:</p>
<h2 id="Hill’s-law"><a href="#Hill’s-law" class="headerlink" title="Hill’s law"></a><strong>Hill’s law</strong></h2><pre><code>Simple and Dumb can be better  
</code></pre><p>…lol</p>
<p>Never stop optimizing until you give out your all.<br>However, don’t forget the Hill’s law.            </p>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/wechat_qcode.jpg" alt="xubing wechat" style="width: 200px; max-width: 100%;"/>
    <div>奇闻共欣赏,疑义相与析.欢迎来我的微信公众号</div>
</div>


      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/algorithm/" rel="tag"># algorithm</a>
          
            <a href="/tags/performanceOptimization/" rel="tag"># performanceOptimization</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/10/30/reviewC/" rel="next" title="常回C看看">
                <i class="fa fa-chevron-left"></i> 常回C看看
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/03/29/saodiseng20160329/" rel="prev" title="偷梁换柱 - copy 和 move">
                偷梁换柱 - copy 和 move <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="xubing" />
          <p class="site-author-name" itemprop="name">xubing</p>
          <p class="site-description motion-element" itemprop="description">Code And Art. Code Is Art.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#关于2Sum"><span class="nav-number">1.</span> <span class="nav-text">关于2Sum</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3sum-摘掉面具"><span class="nav-number">2.</span> <span class="nav-text">3sum-摘掉面具</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#while-True-optimize"><span class="nav-number">3.</span> <span class="nav-text">while True: optimize()</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#排重优化0x00"><span class="nav-number">3.1.</span> <span class="nav-text">排重优化0x00</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#排重优化0x01"><span class="nav-number">3.2.</span> <span class="nav-text">排重优化0x01</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#排重优化0x02"><span class="nav-number">3.3.</span> <span class="nav-text">排重优化0x02</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-去除method-call"><span class="nav-number">3.4.</span> <span class="nav-text">0x03 去除method call</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-去除list-copy"><span class="nav-number">3.5.</span> <span class="nav-text">0x04 去除list copy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-last-shot"><span class="nav-number">3.6.</span> <span class="nav-text">0x05 last shot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x06-Not-the-end"><span class="nav-number">3.7.</span> <span class="nav-text">0x06 Not the end</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hill’s-law"><span class="nav-number">3.8.</span> <span class="nav-text">Hill’s law</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xubing</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
